{{#*inline "itemList"}}
    {{#with (lookup actor.itemTypes type) as |list|}}
    {{#if list.length}}
    <div class="item-list">
        {{#each list as |item|}}
            <div data-item="{{item.data._id}}" class="flexrow">
                <div>
                    {{> @partial-block item=item }}
                </div>
            
                <div class="right">
                    {{#if item.isOwner}}
                        <a data-action="delete"><span class="fas fa-trash"></span></a>
                    {{/if}}
                </div>
            </div>
        {{/each}}
    </div>
    {{/if}}
    {{/with}}
{{/inline}}

<div class="heart flexrow buttons sticky">
    <button data-action="prepare-request-roll"><span class="fas fa-dice"></span> {{localizeHeart "perform" "request-roll"}}</button>
    <button data-action="roll"><span class="fas fa-dice"></span> {{localizeHeart "perform" "roll"}}</button>
    <button data-action="stress-roll"><span class="fas fa-dice"></span> {{localizeHeart "perform" "roll-stress"}}</button>
    <button data-action="fallout-roll"><span class="fas fa-dice"></span> {{localizeHeart "perform" "roll-fallout"}}</button>
</div>
<form class="heart sheet actor character {{cssClass}}" autocomplete="off">
    <div class="grid-2 place-top">
        <img class="profile" src="{{data.img}}" title="{{actor.name}}" data-edit="img"/>
        <div class="grid-3 resistances place-top">
            <div></div>
            <div></div>
            <h3 class="center">{{localizeHeart "resistance" "protection" "label-multiple"}}</h3>
            {{#each actor.data.data.resistances as |resistance name|}}
                <h3 class="left">{{localizeHeart "resistance" name}}</h3>
                <div class="red" data-target='data.resistances.{{name}}.value'>{{{ordered-checkable resistance.value 10}}}</div>
                <div class="red" data-target='data.resistances.{{name}}.protection'>{{{ordered-checkable resistance.protection 5}}}</div>
            {{/each}}
        </div>
        <div class="info">
            <div class="grid-2 auto-first-col place-center">
                <h2>{{localizeHeart "character" "name"}}</h2>
                <input name="name" value="{{actor.name}}"/>
                <h2>{{localizeHeart "character" "class"}}</h2>
                <input name="data.class" value="{{actor.data.data.class}}"/>
                <h2>{{localizeHeart "character" "calling"}}</h2>
                <input name="data.calling" value="{{actor.data.data.calling}}"/>
            </div>
        </div>
        <div class="beats">
            <h2>
                {{localizeHeart "beat" "active" "label-multiple"}}
                {{#if actor.isOwner}}
                <div class="right">
                    <a data-action="add" data-type="beat"><span class="fas fa-plus"></span></a>
                </div>
                {{/if}}
            </h2>
            {{#> itemList type="beat" actor=actor}}
            <a data-action="view">{{item.name}}</a>
            {{/itemList}}
            {{editor content=actor.data.data.active_beats target="data.active_beats" button=true editable=editable owner=owner}}
        </div>
        
        <div class="equipment">
            <h2>{{localizeHeart "equipment" "label-multiple"}}
                {{#if actor.isOwner}}
                <div class="right">
                    <a data-action="add" data-type="equipment"><span class="fas fa-plus"></span></a>
                </div>
                {{/if}}
            </h2>
            {{#> itemList type="equipment"  actor=actor}}
                <a data-action="view">{{item.name}}</a>
                (<a data-action="roll"><span class="fas fa-dice"></span> {{item.data.data.di_size}}</a>, {{join ", " item.data.data.domain array=item.data.data.tags}})
            {{/itemList}}
            {{editor content=actor.data.data.equipment target="data.equipment" button=true editable=editable owner=owner}}
        </div>

        <div class="resources">
            <h2>{{localizeHeart "resource" "label-multiple"}}
                {{#if actor.isOwner}}
                <div class="top right">
                    <a data-action="add" data-type="resource"><span class="fas fa-plus"></span></a>
                </div>
                {{/if}}
            </h2>
            {{#> itemList type="resource" actor=actor}}
            <a data-action="view">{{item.name}}</a>
            (<a data-action="roll"><span class="fas fa-dice"></span> {{item.data.data.di_size}}</a>
            {{#if item.data.data.tags.length}}
            , {{join ", " array=item.data.data.tags}}
            {{/if}})
            {{/itemList}}
            {{editor content=actor.data.data.resources target="data.resources" button=true editable=editable owner=owner}}
        </div>
        <div class="abilities">
            <h2>
                {{localizeHeart "ability"  "label-multiple"}}
                {{#if actor.isOwner}}
                <div class="top right">
                    <a data-action="add" data-type="ability"><span class="fas fa-plus"></span></a>
                </div>
                {{/if}}
            </h2>
            
            {{#> itemList type="ability" actor=actor}}
            <a data-action="view">{{item.name}}</a>
            {{/itemList}}
            {{editor content=actor.data.data.abilities target="data.abilities" button=true editable=editable owner=owner}}
        </div>
        <div class="fallout">
            <h2>
                {{localizeHeart "fallout" "label-multiple"}}
                {{#if actor.isOwner}}
                <div class="top right">
                    <a data-action="add" data-type="fallout"><span class="fas fa-plus"></span></a>
                </div>
                {{/if}}
            </h2>
            {{#> itemList type="fallout" actor=actor}}
            <a data-action="view">{{item.name}}</a>
            {{/itemList}}
            {{editor content=actor.data.data.fallout target="data.fallout" button=true editable=editable owner=owner}}
        </div>
        <div class="skills grid-2 auto-first-col">
            <h3 class="center">{{localizeHeart "skill" "label-multiple"}}</h3>
            <h3 class="faded">{{localizeHeart "skill" "knack" "label-multiple"}}</h3>
            {{#each actor.data.data.skills as |skill name|}}
                <div class="flexrow">
                    <input type="checkbox" name="data.skills.{{name}}.value" {{checked skill.value}}/>
                    <span class="bold">{{localizeHeart "skill" name}}</span>
                </div>
                <input name="data.skills.{{name}}.knack" value="{{skill.knack}}"/>
            {{/each}}
        </div>

        <div class="domains grid-2 auto-first-col">
            <h3 class="center">{{localizeHeart "domain" "label-multiple"}}</h3>
            <h3 class="faded">{{localizeHeart "domain" "knack" "label-multiple"}}</h3>
            {{#each actor.data.data.domains as |domain name|}}
                <div class="flexrow">
                    <input type="checkbox" name="data.domains.{{name}}.value" {{checked domain.value}}/>
                    <span class="bold">{{localizeHeart "domain" name}}</span>
                </div>
                <input name="data.domains.{{name}}.knack" value="{{domain.knack}}"/>
            {{/each}}
        </div>
    </div>
</form>